# Stagehand: page.act vs stagehand.agent æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”

## æ¦‚è¿°

Stagehandé¡¹ç›®æä¾›äº†ä¸¤å¥—å®Œæ•´çš„UIè‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆï¼š

1. **ä¼ ç»Ÿæ–¹æ¡ˆ**ï¼š`page.act` - åŸºäºDOMåˆ†æ
2. **å‰æ²¿æ–¹æ¡ˆ**ï¼š`stagehand.agent` - åŸºäºè§†è§‰è¯†åˆ«ï¼ˆCUAï¼‰

è¿™ä¸¤ç§æ–¹æ¡ˆä»£è¡¨äº†ä¸åŒçš„æŠ€æœ¯è·¯å¾„ï¼Œå„æœ‰å…¶é€‚ç”¨åœºæ™¯å’Œä¼˜åŠ£åŠ¿ã€‚

---

## ğŸ” æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”

### 1. page.act - DOMåˆ†ææ–¹æ¡ˆ

#### **å·¥ä½œåŸç†**

```typescript
// è°ƒç”¨æ–¹å¼
await page.act("ç‚¹å‡»ç™»å½•æŒ‰é’®");

// å†…éƒ¨æµç¨‹
async act(action: string) {
  // 1. è°ƒç”¨ observeAct
  return await this.actHandler.observeAct(actionOrOptions, ...);
}

async observeAct() {
  // 2. å…ˆ observeï¼šåˆ†æDOMç»“æ„ï¼Œä¸æ˜¯æˆªå›¾
  const observeResults = await observeHandler.observe({
    instruction,
    llmClient,      // ä½¿ç”¨ä¼ ç»ŸChat Completions API
    returnAction: true,
  });

  // 3. å† actFromObserveResultï¼šæ‰§è¡ŒPlaywrightæ“ä½œ
  return this.actFromObserveResult(observeResults[0]);
}
```

#### **æ ¸å¿ƒç‰¹ç‚¹**

- **è¾“å…¥æ•°æ®**ï¼šğŸ“„ DOMç»“æ„å’Œæ–‡æœ¬å†…å®¹
- **AIåˆ†æ**ï¼šğŸ§  æ–‡æœ¬ç†è§£å’Œè¯­ä¹‰åˆ†æ
- **APIç±»å‹**ï¼šğŸ’¬ Chat Completions API
- **å®šä½æ–¹å¼**ï¼šğŸ¯ XPathé€‰æ‹©å™¨
- **æ‰§è¡Œæœºåˆ¶**ï¼šâš¡ PlaywrightåŸç”Ÿæ–¹æ³•

#### **observeç»“æœç¤ºä¾‹**

```typescript
// åˆ†æDOMç»“æ„ï¼Œç”Ÿæˆé€‰æ‹©å™¨
{
  selector: "xpath=//button[contains(text(), 'ç™»å½•')]",
  method: "click",
  arguments: [],
  description: "click the login button"
}

// ç„¶åä½¿ç”¨Playwrightæ‰§è¡Œ
const locator = deepLocator(page, xpath).first();
await locator.click();  // åŸç”ŸPlaywrightæ“ä½œ
```

---

### 2. stagehand.agent - CUAè§†è§‰æ–¹æ¡ˆ

#### **å·¥ä½œåŸç†**

```typescript
// è°ƒç”¨æ–¹å¼
const agent = stagehand.agent({
  provider: "anthropic",
  model: "computer-use-preview",
});
await agent.execute("ç‚¹å‡»ç™»å½•æŒ‰é’®");

// å†…éƒ¨æµç¨‹ (AnthropicCUAClient)
async execute(instruction: string) {
  while (!completed && step < maxSteps) {
    // 1. æˆªå›¾
    const screenshot = await this.actionHandler.screenshot();

    // 2. å‘é€ç»™AIåˆ†æ
    const response = await this.getAction(screenshot, instruction);

    // 3. æ‰§è¡Œè¿”å›çš„æ“ä½œ
    await this.takeAction(response);
  }
}
```

#### **æ ¸å¿ƒç‰¹ç‚¹**

- **è¾“å…¥æ•°æ®**ï¼šğŸ“· é¡µé¢æˆªå›¾
- **AIåˆ†æ**ï¼šğŸ‘ï¸ è®¡ç®—æœºè§†è§‰è¯†åˆ«
- **APIç±»å‹**ï¼šğŸ¤– Responses API / Messages API
- **å®šä½æ–¹å¼**ï¼šğŸ“ åƒç´ åæ ‡
- **æ‰§è¡Œæœºåˆ¶**ï¼šğŸ–±ï¸ åŸç”Ÿæ“ä½œæ¨¡æ‹Ÿ

#### **AIå“åº”ç¤ºä¾‹**

```json
{
  "type": "tool_use",
  "name": "computer",
  "input": {
    "action": "left_click",
    "coordinate": [394, 533] // ç›´æ¥åæ ‡ç‚¹å‡»
  }
}
```

---

## ğŸ“Š è¯¦ç»†å¯¹æ¯”è¡¨

| ç»´åº¦           | page.act (DOMæ–¹æ¡ˆ) | stagehand.agent (CUAæ–¹æ¡ˆ) |
| -------------- | ------------------ | ------------------------- |
| **æŠ€æœ¯åŸºç¡€**   | DOMè§£æ + æ–‡æœ¬LLM  | è®¡ç®—æœºè§†è§‰ + CUAæ¨¡å‹      |
| **è¾“å…¥æ–¹å¼**   | ç½‘é¡µDOMç»“æ„        | é¡µé¢æˆªå›¾                  |
| **AIèƒ½åŠ›è¦æ±‚** | æ–‡æœ¬ç†è§£           | è§†è§‰è¯†åˆ«                  |
| **APIä¾èµ–**    | Chat Completions   | Responses/Messages API    |
| **å®šä½ç²¾åº¦**   | é«˜ï¼ˆåŸºäºç»“æ„ï¼‰     | ä¸­ï¼ˆåŸºäºè§†è§‰ï¼‰            |
| **é€šç”¨æ€§**     | ä»…é™ç½‘é¡µ           | ä»»æ„ç•Œé¢                  |
| **æ€§èƒ½**       | å¿«é€Ÿ               | è¾ƒæ…¢ï¼ˆå›¾åƒå¤„ç†ï¼‰          |
| **ç¨³å®šæ€§**     | é«˜                 | ä¸­ç­‰                      |
| **å­¦ä¹ æˆæœ¬**   | ä½                 | é«˜                        |
| **è°ƒè¯•éš¾åº¦**   | ä½                 | é«˜                        |

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯å»ºè®®

### page.act é€‚ç”¨åœºæ™¯

âœ… **æ¨èä½¿ç”¨ï¼š**

- ç½‘é¡µè‡ªåŠ¨åŒ–æµ‹è¯•
- è¡¨å•å¡«å†™å’Œæäº¤
- ç”µå•†ç½‘ç«™æ“ä½œ
- å†…å®¹ç®¡ç†ç³»ç»Ÿ
- SPAåº”ç”¨äº¤äº’
- éœ€è¦é«˜ç²¾åº¦å’Œç¨³å®šæ€§çš„åœºæ™¯

âŒ **ä¸é€‚ç”¨ï¼š**

- æ¡Œé¢åº”ç”¨ç¨‹åº
- ç§»åŠ¨åº”ç”¨ç•Œé¢
- æ¸¸æˆç•Œé¢
- å›¾åƒéªŒè¯ç 
- å¤æ‚Canvasåº”ç”¨

### stagehand.agent é€‚ç”¨åœºæ™¯

âœ… **æ¨èä½¿ç”¨ï¼š**

- è·¨å¹³å°è‡ªåŠ¨åŒ–ï¼ˆæ¡Œé¢+ç½‘é¡µï¼‰
- å¤æ‚å›¾å½¢ç•Œé¢æ“ä½œ
- æ¸¸æˆè‡ªåŠ¨åŒ–
- ç§»åŠ¨åº”ç”¨æ¨¡æ‹Ÿ
- é—ç•™ç³»ç»Ÿï¼ˆæ— APIï¼‰
- å›¾åƒéªŒè¯ç å¤„ç†

âŒ **ä¸é€‚ç”¨ï¼š**

- å¯¹ç²¾åº¦è¦æ±‚æé«˜çš„åœºæ™¯
- å¤§æ‰¹é‡å¿«é€Ÿæ“ä½œ
- èµ„æºå—é™ç¯å¢ƒ
- éœ€è¦äºšåƒç´ çº§ç²¾åº¦

---

## ğŸ”§ å®é™…ä»£ç ç¤ºä¾‹

### page.act ç¤ºä¾‹

```typescript
import { Stagehand } from "@browserbasehq/stagehand";

const stagehand = new Stagehand({ env: "LOCAL" });
await stagehand.init();

// å¯¼èˆªåˆ°é¡µé¢
await stagehand.page.goto("https://example.com/login");

// ä½¿ç”¨DOMåˆ†ææ–¹å¼æ“ä½œ
await stagehand.page.act("åœ¨ç”¨æˆ·åè¾“å…¥æ¡†è¾“å…¥ 'admin'");
await stagehand.page.act("åœ¨å¯†ç è¾“å…¥æ¡†è¾“å…¥ 'password123'");
await stagehand.page.act("ç‚¹å‡»ç™»å½•æŒ‰é’®");

// æå–æ•°æ®
const result = await stagehand.page.extract({
  instruction: "è·å–ç™»å½•åçš„ç”¨æˆ·ä¿¡æ¯",
  schema: z.object({
    username: z.string(),
    role: z.string(),
  }),
});
```

### stagehand.agent ç¤ºä¾‹

```typescript
import { Stagehand } from "@browserbasehq/stagehand";

const stagehand = new Stagehand({ env: "LOCAL" });
await stagehand.init();

// åˆ›å»ºCUAä»£ç†
const agent = stagehand.agent({
  provider: "anthropic",
  model: "computer-use-preview",
  instructions: "ä½ æ˜¯ä¸€ä¸ªç½‘é¡µè‡ªåŠ¨åŒ–åŠ©æ‰‹",
});

// å¯¼èˆªåˆ°é¡µé¢
await stagehand.page.goto("https://example.com/login");

// ä½¿ç”¨è§†è§‰è¯†åˆ«æ–¹å¼æ“ä½œ
await agent.execute(`
  è¯·å¸®æˆ‘å®Œæˆç™»å½•æµç¨‹ï¼š
  1. åœ¨ç”¨æˆ·åè¾“å…¥æ¡†è¾“å…¥ 'admin'
  2. åœ¨å¯†ç è¾“å…¥æ¡†è¾“å…¥ 'password123'  
  3. ç‚¹å‡»ç™»å½•æŒ‰é’®
  4. æ£€æŸ¥æ˜¯å¦ç™»å½•æˆåŠŸ
`);
```

---

## âš–ï¸ ä¼˜åŠ£åŠ¿åˆ†æ

### page.act ä¼˜åŠ¿

- âœ… **ç²¾ç¡®å¯é **ï¼šåŸºäºDOMç»“æ„ï¼Œå®šä½å‡†ç¡®
- âœ… **æ€§èƒ½ä¼˜ç§€**ï¼šæ— éœ€å›¾åƒå¤„ç†ï¼Œé€Ÿåº¦å¿«
- âœ… **æˆæœ¬è¾ƒä½**ï¼šä½¿ç”¨ä¼ ç»ŸLLMï¼ŒTokenæ¶ˆè€—å°‘
- âœ… **è°ƒè¯•å‹å¥½**ï¼šå¯ä»¥æŸ¥çœ‹ç”Ÿæˆçš„xpathé€‰æ‹©å™¨
- âœ… **å…¼å®¹æ€§å¥½**ï¼šæ”¯æŒæ‰€æœ‰ä¸»æµLLMå‚å•†

### page.act åŠ£åŠ¿

- âŒ **å±€é™æ€§å¤§**ï¼šä»…é™äºç½‘é¡µï¼Œæ— æ³•æ§åˆ¶æ¡Œé¢åº”ç”¨
- âŒ **ä¾èµ–DOM**ï¼šåŠ¨æ€ç”Ÿæˆå†…å®¹å¯èƒ½å¤±æ•ˆ
- âŒ **æ¡†æ¶é™åˆ¶**ï¼šæŸäº›JSæ¡†æ¶å¯èƒ½å¹²æ‰°DOMåˆ†æ

### stagehand.agent ä¼˜åŠ¿

- âœ… **é€šç”¨æ€§å¼º**ï¼šå¯æ§åˆ¶ä»»æ„ç±»å‹ç•Œé¢
- âœ… **æ›´æ™ºèƒ½**ï¼šå…·å¤‡è§†è§‰ç†è§£èƒ½åŠ›
- âœ… **é€‚åº”æ€§å¥½**ï¼šç•Œé¢å˜åŒ–æ—¶ä»èƒ½å·¥ä½œ
- âœ… **æœªæ¥å¯¼å‘**ï¼šä»£è¡¨AIå‘å±•è¶‹åŠ¿

### stagehand.agent åŠ£åŠ¿

- âŒ **æ€§èƒ½è¾ƒæ…¢**ï¼šéœ€è¦æˆªå›¾å’Œè§†è§‰å¤„ç†
- âŒ **æˆæœ¬è¾ƒé«˜**ï¼šè§†è§‰AIæ¨¡å‹è´¹ç”¨é«˜
- âŒ **å‡†ç¡®åº¦é£é™©**ï¼šåæ ‡å¯èƒ½ä¸å¤Ÿç²¾ç¡®
- âŒ **è°ƒè¯•å›°éš¾**ï¼šéš¾ä»¥ç†è§£AIçš„å†³ç­–è¿‡ç¨‹
- âŒ **å‚å•†ä¾èµ–**ï¼šä»…æ”¯æŒOpenAIå’ŒAnthropic

---

## ğŸš€ æœ€ä½³å®è·µå»ºè®®

### 1. æ··åˆä½¿ç”¨ç­–ç•¥

```typescript
// å¯¹äºç½‘é¡µæ“ä½œï¼Œä¼˜å…ˆä½¿ç”¨ page.act
if (isWebpage) {
  await page.act("å¡«å†™è¡¨å•");
} else {
  // å¯¹äºæ¡Œé¢åº”ç”¨ï¼Œä½¿ç”¨ agent
  await agent.execute("æ“ä½œæ¡Œé¢åº”ç”¨");
}
```

### 2. é”™è¯¯å¤„ç†å’Œé™çº§

```typescript
try {
  // ä¼˜å…ˆå°è¯•ç²¾ç¡®çš„ page.act
  await page.act("ç‚¹å‡»æäº¤æŒ‰é’®");
} catch (error) {
  // é™çº§åˆ° agent æ–¹å¼
  await agent.execute("ç‚¹å‡»æäº¤æŒ‰é’®");
}
```

### 3. æ€§èƒ½ä¼˜åŒ–

```typescript
// å¯¹äºæ‰¹é‡æ“ä½œï¼Œä½¿ç”¨ page.act
for (const item of items) {
  await page.act(`å¤„ç†é¡¹ç›® ${item.id}`);
}

// å¯¹äºå¤æ‚æµç¨‹ï¼Œä½¿ç”¨ agent
await agent.execute("å®Œæˆæ•´ä¸ªè®¢å•æµç¨‹");
```

---

## ğŸ”® å‘å±•è¶‹åŠ¿

### çŸ­æœŸï¼ˆ2025-2026ï¼‰

- **page.act**ï¼šç»§ç»­ä¼˜åŒ–DOMåˆ†æç²¾åº¦ï¼Œæ”¯æŒæ›´å¤šæ¡†æ¶
- **stagehand.agent**ï¼šé™ä½æˆæœ¬ï¼Œæé«˜è¯†åˆ«å‡†ç¡®åº¦

### ä¸­æœŸï¼ˆ2026-2028ï¼‰

- ä¸¤ç§æ–¹æ¡ˆæ·±åº¦èåˆï¼Œæ™ºèƒ½é€‰æ‹©æœ€ä½³ç­–ç•¥
- CUAæŠ€æœ¯æ™®åŠï¼Œæˆæœ¬å¤§å¹…ä¸‹é™
- æ”¯æŒæ›´å¤šAIå‚å•†å’Œæ¨¡å‹

### é•¿æœŸï¼ˆ2028+ï¼‰

- CUAæˆä¸ºä¸»æµï¼ŒDOMåˆ†æä½œä¸ºè¡¥å……
- å®ç°çœŸæ­£çš„è·¨å¹³å°ç»Ÿä¸€è‡ªåŠ¨åŒ–
- AI Agentå…·å¤‡æ›´å¼ºçš„æ¨ç†å’Œè§„åˆ’èƒ½åŠ›

---

## ğŸ“‹ æŠ€æœ¯æ¶æ„å›¾

```mermaid
graph TB
    subgraph "Stagehand åŒå¼•æ“æ¶æ„"
        A[ç”¨æˆ·æŒ‡ä»¤] --> B{é€‰æ‹©æ‰§è¡Œæ–¹å¼}

        B -->|ç½‘é¡µæ“ä½œ| C[page.act å¼•æ“]
        B -->|é€šç”¨ç•Œé¢| D[stagehand.agent å¼•æ“]

        subgraph "DOMåˆ†æå¼•æ“"
            C --> E[DOMè§£æ]
            E --> F[LLMæ–‡æœ¬åˆ†æ]
            F --> G[XPathé€‰æ‹©å™¨]
            G --> H[Playwrightæ‰§è¡Œ]
        end

        subgraph "CUAè§†è§‰å¼•æ“"
            D --> I[é¡µé¢æˆªå›¾]
            I --> J[CUAè§†è§‰åˆ†æ]
            J --> K[åæ ‡å®šä½]
            K --> L[åŸç”Ÿæ“ä½œ]
        end

        H --> M[æ‰§è¡Œç»“æœ]
        L --> M
    end
```

---

## ğŸ’¡ ç»“è®º

Stagehandé¡¹ç›®é€šè¿‡æä¾›**ä¸¤å¥—å®Œæ•´çš„æŠ€æœ¯æ–¹æ¡ˆ**ï¼Œå®ç°äº†ä»ä¼ ç»ŸDOMè‡ªåŠ¨åŒ–åˆ°å‰æ²¿è§†è§‰AIçš„å…¨è¦†ç›–ï¼š

1. **page.act**ï¼šæˆç†Ÿç¨³å®šçš„ç½‘é¡µè‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆ
2. **stagehand.agent**ï¼šå‰æ²¿çš„é€šç”¨ç•Œé¢æ§åˆ¶æŠ€æœ¯

é€‰æ‹©å“ªç§æ–¹æ¡ˆä¸»è¦å–å†³äºï¼š

- **åº”ç”¨åœºæ™¯**ï¼šç½‘é¡µ vs é€šç”¨ç•Œé¢
- **ç²¾åº¦è¦æ±‚**ï¼šé«˜ç²¾åº¦ vs é€‚åº”æ€§
- **æ€§èƒ½è€ƒè™‘**ï¼šé€Ÿåº¦ vs æ™ºèƒ½
- **æˆæœ¬é¢„ç®—**ï¼šç»æµ vs å…ˆè¿›

åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå»ºè®®æ ¹æ®å…·ä½“éœ€æ±‚çµæ´»é€‰æ‹©ï¼Œç”šè‡³å¯ä»¥åœ¨åŒä¸€é¡¹ç›®ä¸­æ··åˆä½¿ç”¨ä¸¤ç§æ–¹æ¡ˆï¼Œå……åˆ†å‘æŒ¥å„è‡ªçš„ä¼˜åŠ¿ã€‚
